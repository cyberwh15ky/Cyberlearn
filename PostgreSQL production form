 **Database ç”Ÿç”¢ç’°å¢ƒè¡¨æ ¼ (PostgreSQL ç‚ºä¾‹)**ï¼Œæ¶µè“‹ä½ æåˆ°çš„åŠŸèƒ½ï¼šå¸³è™Ÿç³»çµ± (å« Google OAuth / Email è¨»å†Š)ã€2FAã€ç”¢å“ç€è¦½/æ”¶è—/é»è®šã€è³¼ç‰©è»Šã€è¨‚å–®ã€ä»˜æ¬¾ã€ç‰©æµï¼Œä»¥åŠæœªä¾† POS æ“´å……ã€‚é€™ä»½è¡¨æ ¼æ˜¯ **ç”Ÿç”¢ç’°å¢ƒè¨­è¨ˆè—æœ¬**ï¼Œä½ å¯ä»¥ç›´æ¥æ”¾é€² GitHub çš„ `docs/database-schema.md`ã€‚

---

# ğŸ“‘ Database Schema (Production)

## 1. Users (å¸³è™Ÿç³»çµ±)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| user_id             | UUID             | PK, default gen_random_uuid()        | ä½¿ç”¨è€…å”¯ä¸€è­˜åˆ¥ |
| name                | VARCHAR(100)     | NOT NULL                             | å§“å |
| email               | VARCHAR(255)     | UNIQUE, NOT NULL                     | éƒµä»¶ |
| phone_number        | VARCHAR(20)      | UNIQUE                               | æ‰‹æ©Ÿè™Ÿç¢¼ |
| birth_date          | DATE             |                                      | å‡ºç”Ÿå¹´æœˆæ—¥ |
| password_hash       | TEXT             | NULLABLE (Google OAuth å¯ä¸éœ€å¯†ç¢¼)   | å¯†ç¢¼é›œæ¹Š |
| google_oauth_id     | VARCHAR(255)     | UNIQUE                               | Google å¸³è™Ÿç¶å®š |
| is_active           | BOOLEAN          | DEFAULT TRUE                         | å¸³è™Ÿç‹€æ…‹ |
| created_at          | TIMESTAMP        | DEFAULT now()                        | å»ºç«‹æ™‚é–“ |
| updated_at          | TIMESTAMP        | DEFAULT now()                        | æ›´æ–°æ™‚é–“ |

---

## 2. TwoFactorAuth (2FA)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| user_id             | UUID             | PK, FK â†’ Users(user_id)              | å°æ‡‰ä½¿ç”¨è€… |
| totp_secret         | VARCHAR(64)      | NOT NULL                             | Google Authenticator ç§˜é‘° |
| sms_code_last       | VARCHAR(6)       |                                      | æœ€è¿‘ä¸€æ¬¡ SMS é©—è­‰ç¢¼ |
| sms_verified        | BOOLEAN          | DEFAULT FALSE                        | æ˜¯å¦å®Œæˆ SMS é©—è­‰ |
| last_verified_at    | TIMESTAMP        |                                      | æœ€è¿‘é©—è­‰æ™‚é–“ |

---

## 3. Products (ç”¢å“)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| product_id          | UUID             | PK                                   | ç”¢å“å”¯ä¸€è­˜åˆ¥ |
| name                | VARCHAR(255)     | NOT NULL                             | ç”¢å“åç¨± |
| description         | TEXT             |                                      | ç”¢å“æè¿° |
| price               | DECIMAL(10,2)    | NOT NULL                             | åƒ¹æ ¼ |
| stock_quantity      | INT              | DEFAULT 0                            | åº«å­˜æ•¸é‡ |
| like_count          | INT              | DEFAULT 0                            | é»è®šæ•¸ (å…¬é–‹é¡¯ç¤º) |
| created_at          | TIMESTAMP        | DEFAULT now()                        | å»ºç«‹æ™‚é–“ |
| updated_at          | TIMESTAMP        | DEFAULT now()                        | æ›´æ–°æ™‚é–“ |

---

## 4. Favorites & Likes (æ”¶è—èˆ‡é»è®š)
### Favorites
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| favorite_id         | UUID             | PK                                   | æ”¶è—å”¯ä¸€è­˜åˆ¥ |
| user_id             | UUID             | FK â†’ Users(user_id)                  | ä½¿ç”¨è€… |
| product_id          | UUID             | FK â†’ Products(product_id)            | ç”¢å“ |
| created_at          | TIMESTAMP        | DEFAULT now()                        | æ”¶è—æ™‚é–“ |

### Likes
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| like_id             | UUID             | PK                                   | é»è®šå”¯ä¸€è­˜åˆ¥ |
| user_id             | UUID             | FK â†’ Users(user_id)                  | ä½¿ç”¨è€… |
| product_id          | UUID             | FK â†’ Products(product_id)            | ç”¢å“ |
| created_at          | TIMESTAMP        | DEFAULT now()                        | é»è®šæ™‚é–“ |

---

## 5. Cart (è³¼ç‰©è»Š)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| cart_id             | UUID             | PK                                   | è³¼ç‰©è»Šå”¯ä¸€è­˜åˆ¥ |
| user_id             | UUID             | FK â†’ Users(user_id)                  | ä½¿ç”¨è€… |
| created_at          | TIMESTAMP        | DEFAULT now()                        | å»ºç«‹æ™‚é–“ |

### CartItems
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| cart_item_id        | UUID             | PK                                   | è³¼ç‰©è»Šé …ç›®å”¯ä¸€è­˜åˆ¥ |
| cart_id             | UUID             | FK â†’ Cart(cart_id)                   | è³¼ç‰©è»Š |
| product_id          | UUID             | FK â†’ Products(product_id)            | ç”¢å“ |
| quantity            | INT              | DEFAULT 1                            | æ•¸é‡ |
| reserved_at         | TIMESTAMP        | DEFAULT now()                        | é å®šæ™‚é–“ |

---

## 6. Orders (è¨‚å–®)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| order_id            | UUID             | PK                                   | è¨‚å–®å”¯ä¸€è­˜åˆ¥ |
| user_id             | UUID             | FK â†’ Users(user_id)                  | ä½¿ç”¨è€… |
| status              | VARCHAR(50)      | DEFAULT 'pending'                    | è¨‚å–®ç‹€æ…‹ (pending/paid/shipped/completed/cancelled) |
| total_amount        | DECIMAL(10,2)    | NOT NULL                             | ç¸½é‡‘é¡ |
| payment_method      | VARCHAR(50)      | NOT NULL                             | CreditCard / Alipay / PayMe / FPS |
| shipping_method     | VARCHAR(50)      | NOT NULL                             | COD / Postal |
| created_at          | TIMESTAMP        | DEFAULT now()                        | å»ºç«‹æ™‚é–“ |
| updated_at          | TIMESTAMP        | DEFAULT now()                        | æ›´æ–°æ™‚é–“ |

### OrderItems
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| order_item_id       | UUID             | PK                                   | è¨‚å–®é …ç›®å”¯ä¸€è­˜åˆ¥ |
| order_id            | UUID             | FK â†’ Orders(order_id)                | è¨‚å–® |
| product_id          | UUID             | FK â†’ Products(product_id)            | ç”¢å“ |
| quantity            | INT              | NOT NULL                             | æ•¸é‡ |
| price               | DECIMAL(10,2)    | NOT NULL                             | å–®åƒ¹ |

---

## 7. Payments (ä»˜æ¬¾)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| payment_id          | UUID             | PK                                   | ä»˜æ¬¾å”¯ä¸€è­˜åˆ¥ |
| order_id            | UUID             | FK â†’ Orders(order_id)                | å°æ‡‰è¨‚å–® |
| provider            | VARCHAR(50)      | NOT NULL                             | Stripe / Alipay / PayMe / FPS |
| transaction_id      | VARCHAR(255)     | UNIQUE                               | ç¬¬ä¸‰æ–¹äº¤æ˜“ç·¨è™Ÿ |
| status              | VARCHAR(50)      | DEFAULT 'initiated'                  | initiated/success/failed/refunded |
| paid_at             | TIMESTAMP        |                                      | ä»˜æ¬¾æ™‚é–“ |

---

## 8. Shipping (ç‰©æµ)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| shipping_id         | UUID             | PK                                   | ç‰©æµå”¯ä¸€è­˜åˆ¥ |
| order_id            | UUID             | FK â†’ Orders(order_id)                | å°æ‡‰è¨‚å–® |
| provider            | VARCHAR(100)     | NOT NULL                             | SF Express / HK Post / Custom |
| tracking_number     | VARCHAR(255)     | UNIQUE                               | ç‰©æµè¿½è¹¤è™Ÿç¢¼ |
| status              | VARCHAR(50)      | DEFAULT 'pending'                    | pending/shipped/delivered |
| shipped_at          | TIMESTAMP        |                                      | å‡ºè²¨æ™‚é–“ |
| delivered_at        | TIMESTAMP        |                                      | å®Œæˆæ™‚é–“ |

---

## 9. POS (æœªä¾†æ“´å……)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| pos_id              | UUID             | PK                                   | POS å”¯ä¸€è­˜åˆ¥ |
| store_location      | VARCHAR(255)     |                                      | åº—èˆ–ä½ç½® |
| terminal_id         | VARCHAR(100)     | UNIQUE                               | çµ‚ç«¯æ©Ÿç·¨è™Ÿ |
| synced_at           | TIMESTAMP        |                                      | èˆ‡ç·šä¸Šç³»çµ±åŒæ­¥æ™‚é–“ |

---

## 10. AI Logs (å…è²» AI åŠŸèƒ½)
| Column              | Type              | Constraints                          | Notes |
|---------------------|------------------|--------------------------------------|-------|
| ai_log_id           | UUID             | PK                                   | AI è«®è©¢å”¯ä¸€è­˜åˆ¥ |
| user_id             | UUID             | FK â†’ Users(user_id)                  | ä½¿ç”¨è€… |
| query_text          | TEXT             | NOT NULL                             | ä½¿ç”¨è€…è¼¸å…¥ |
| response_text       | TEXT             | NOT NULL                             | AI å›è¦† |
| created_at          | TIMESTAMP        | DEFAULT now()                        | å»ºç«‹æ™‚é–“ |

---

## ğŸ” å®‰å…¨èˆ‡å‚™ä»½å»ºè­°
- **Palo Alto Firewall + SIEM**ï¼šä¿è­· API èˆ‡æµé‡ï¼Œé›†ä¸­
